"use strict";var Tour=require("./../models/tourModel"),User=require("./../models/userModel"),Booking=require("./../models/bookingModel"),catchAsync=require("./../utils/catchAsync"),AppError=require("./../utils/appError");exports.getOverview=catchAsync(function(e,r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Tour.find());case 2:t=e.sent,r.status(200).render("overview",{title:"All Tours",tours:t});case 4:case"end":return e.stop()}})}),exports.getTour=catchAsync(function(r,t,n){var o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Tour.findOne({slug:r.params.slug}).populate({path:"reviews",fields:"review rating user"}));case 2:if(o=e.sent){e.next=5;break}return e.abrupt("return",n(new AppError("There is no tour with that name.",404)));case 5:t.status(200).render("tour",{title:"".concat(o.name," Tour"),tour:o});case 6:case"end":return e.stop()}})}),exports.getLoginForm=function(e,r){r.status(200).render("login",{title:"Log into your account"})},exports.getAccount=function(e,r){r.status(200).render("account",{title:"Your account"})},exports.getMyTours=catchAsync(function(r,t){var n,o,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Booking.find({user:r.user.id}));case 2:return n=e.sent,o=n.map(function(e){return e.tour}),e.next=6,regeneratorRuntime.awrap(Tour.find({_id:{$in:o}}));case 6:s=e.sent,t.status(200).render("overview",{title:"My Tours",tours:s});case 8:case"end":return e.stop()}})}),exports.updateUserData=catchAsync(function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(User.findByIdAndUpdate(r.user.id,{name:r.body.name,email:r.body.email},{new:!0,runValidators:!0}));case 2:n=e.sent,t.status(200).render("account",{title:"Your account",user:n});case 4:case"end":return e.stop()}})});
"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(t,!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var AppError=require("./../utils/appError"),handleCastErrorDB=function(r){var e="Invalid ".concat(r.path,": ").concat(r.value);return new AppError(e,404)},handleDuplicateFieldsDB=function(r){var e=r.errmsg.match(/(["'])(\\?.)*?\1/)[0],t="Duplicate field value: ".concat(e,". Please use another value!");return new AppError(t,400)},handleValidationErrorDB=function(r){var e=Object.values(r.errors).map(function(r){return r.message}),t="Invalid input data. ".concat(e.join(". "));return new AppError(t,400)},handleJWTError=function(){return new AppError("Invalid token. Please log in again!",401)},handleJWTExpiredError=function(){return new AppError("Your token has expired! Please log in again.",401)},sendErrorDev=function(r,e,t){return e.originalUrl.startsWith("/api")?t.status(r.statusCode).json({status:r.status,error:r,message:r.message,stack:r.stack}):(console.error("ERROR ðŸ’¥",r),t.status(r.statusCode).render("error",{title:"Something went wrong!",msg:r.message}))},sendErrorProd=function(r,e,t){return e.originalUrl.startsWith("/api")?r.isOperational?t.status(r.statusCode).json({status:r.status,message:r.message}):(console.error("ERROR ðŸ’¥",r),t.status(500).json({status:"error",message:"Something went very wrong!"})):r.isOperational?t.status(r.statusCode).render("error",{title:"Something went wrong!",msg:r.message}):(console.error("ERROR ðŸ’¥",r),t.status(r.statusCode).render("error",{title:"Something went wrong!",msg:"Please try again later."}))};module.exports=function(r,e,t,n){if(r.statusCode=r.statusCode||500,r.status=r.status||"error","development"===process.env.NODE_ENV)sendErrorDev(r,e,t);else if("production"===process.env.NODE_ENV){var o=_objectSpread({},r);o.message=r.message,"CastError"===o.name&&(o=handleCastErrorDB(o)),11e3===o.code&&(o=handleDuplicateFieldsDB(o)),"ValidationError"===o.name&&(o=handleValidationErrorDB(o)),"JsonWebTokenError"===o.name&&(o=handleJWTError()),"TokenExpiredError"===o.name&&(o=handleJWTExpiredError()),sendErrorProd(o,e,t)}};
"use strict";var mongoose=require("mongoose"),bcrypt=require("bcryptjs"),validator=require("validator"),userSchema=new mongoose.Schema({name:{type:String,required:[!0,"Please tell us your name!"]},email:{type:String,required:[!0,"Please tell us your email"],unique:!0,lowercase:!0,validate:[validator.isEmail,"Please provide a valid email"]},photo:String,password:{type:String,required:[!0,"Please provide a password"],minlength:8,select:!1},passwordConfirm:{type:String,required:[!0,"Please confirm your password"],validate:{validator:function(e){return e===this.password},message:"Passwords are not the same!"}},passwordChangedAt:Date});userSchema.pre("save",function(r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isModified("password")){e.next=2;break}return e.abrupt("return",r());case 2:return e.next=4,regeneratorRuntime.awrap(bcrypt.hash(this.password,12));case 4:this.password=e.sent,this.passwordConfirm=void 0;case 6:case"end":return e.stop()}},null,this)}),userSchema.methods.correctPassword=function(r,s){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(bcrypt.compare(r,s));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}})},userSchema.methods.changedPasswordAfter=function(e){return!!this.passwordChangedAt&&e<parseInt(this.passwordChangedAt.getTime()/1e3,10)};var User=mongoose.model("User",userSchema);module.exports=User;